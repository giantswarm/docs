
---
date: 2024-10-17T14:00:00
title: Highlights for the week ending 2024-10-17
changes_categories:
  - Highlights
owner:
  - https://github.com/orgs/giantswarm/teams/sig-product
---

## General

<!-- This where BREAKING CHANGES ARE HIGHLIGHTED -->

## Apps

- [dashboards](https://github.com/giantswarm/dashboards) 
  - [3.25.0](https://github.com/giantswarm/dashboards/compare/v3.24.0...v3.25.0)
      * Added "Loki - Slow Queries" dashboard
      * Change ownership from BigMac to Shield
- [kube-prometheus-stack-app](https://github.com/giantswarm/kube-prometheus-stack-app) 
  - [12.0.0](https://github.com/giantswarm/kube-prometheus-stack-
app/compare/v11.0.0...v12.0.0) 
      * Upgraded chart dependency to [kube-prometheus-stack-65.1.1](https://github.com/prometheus-community/helm-charts/releases/tag/kube-prometheus-stack-65.1.1)
      * prometheus-operator from 0.75.0 to [0.77.1](https://github.com/prometheus-operator/prometheus-operator/releases/tag/v0.77.1)
      * prometheus upgraded from 2.53.0 to [2.54.1](https://github.com/prometheus/prometheus/releases/tag/v2.54.1)
      * grafana from 8.2.0 to [8.5.0](https://github.com/grafana/helm-charts/releases/tag/grafana-8.5.0)
      * thanos ruler upgraded from 0.35.1 to [0.36.1](https://github.com/thanos-io/thanos/releases/tag/v0.36.1)
      * prometheus-node-exporter upgraded from 1.8.1 to [1.8.2](https://github.com/prometheus/node_exporter/releases/tag/v1.8.2)
      * Get rid of legacy in-house slo framework.
- [prometheus-operator-crd](https://github.com/giantswarm/prometheus-operator-crd) 
  - [12.0.0](https://github.com/giantswarm/prometheus-operator-
crd/compare/v11.0.1...v12.0.0) 
      * Upgrade CRDs chart from 13.0.2 (prometheus-operator 0.75.2) to 15.0.0 (prometheus-operator 0.77.1) - See [upstream changelog](https://github.com/prometheus-operator/prometheus-operator/blob/main/CHANGELOG.md#0771--2024-09-25) for more information
- [prometheus-rules](https://github.com/giantswarm/prometheus-rules) 
  - [4.19.0](https://github.com/giantswarm/prometheus-
rules/compare/v4.18.0...v4.19.0) 
      * Alert `StatefulsetNotSatisfiedAtlas`
      * Update alloy-app to 0.6.1. This includes:
      * an upgrade to upstream version 1.4.2
      * a ciliumnetworkpolicy fix for clustering.
- [cluster-cloud-director](https://github.com/giantswarm/cluster-cloud-director) 
  - [0.61.1](https://github.com/giantswarm/cluster-cloud-
director/compare/v0.61.0...v0.61.1) 
      * Corrected systemd unit templating.
  - [0.61.0](https://github.com/giantswarm/cluster-cloud-
director/compare/v0.60.0...v0.61.0) 
### **Breaking change**.
> [!CAUTION] It is important that you check each of the sections in the
> upgrade guide below. Note that some may not apply to your specific cluster
> configuration. However, the cleanup section must always be run against the
> cluster values.
VALUES MIGRATION GUIDE (from v0.60.0) Use the snippets below if the section
applies to your chart's values: ## Control plane machineTemplate creation
`v0.61.0` moves certain values from `.Values.global.controlPlane` to
`.Values.global.controlPlane.machineTemplate`. **This applies to all clusters,
do not skip this**. ``` yq eval --inplace
'with(select(.global.controlPlane.catalog != null);
.global.controlPlane.machineTemplate.catalog = .global.controlPlane.catalog) |
with(select(.global.controlPlane.diskSizeGB != null);
.global.controlPlane.machineTemplate.diskSizeGB =
.global.controlPlane.diskSizeGB) |
with(select(.global.controlPlane.placementPolicy != null);
.global.controlPlane.machineTemplate.placementPolicy =
.global.controlPlane.placementPolicy) |
with(select(.global.controlPlane.sizingPolicy != null);
.global.controlPlane.machineTemplate.sizingPolicy =
.global.controlPlane.sizingPolicy) |
with(select(.global.controlPlane.storageProfile != null);
.global.controlPlane.machineTemplate.storageProfile =
.global.controlPlane.storageProfile) |
with(select(.global.controlPlane.template != null);
.global.controlPlane.machineTemplate.template =
.global.controlPlane.template)' values.yaml ``` ## Control plane endpoint
address If the controlPlane endpoint IP (loadbalancer for the Kubernetes API)
has been statically assigned (**this likely will not apply to workload
clusters**) then this value will need to be duplicated to the
extraCertificateSANs list. ``` yq eval --inplace
'with(select(.global.connectivity.network.controlPlaneEndpoint.host != null);
.cluster.internal.advancedConfiguration.controlPlane.apiServer.extraCertificateSANs
+= [ .global.connectivity.network.controlPlaneEndpoint.host ])' values.yaml
``` ## API server admission plugins The default list is
[here](https://github.com/giantswarm/cluster/blob/main/helm/cluster/templates/clusterapi/controlplane/_helpers_clusterconfiguration_apiserver.tpl#L104).
If you have not extended this list then you do not need to provide a list of
admission plugins at all (defaults will be used from the cluster chart). If
you have enabled additional plugins then you will need to run the command
below. ``` yq eval --inplace
'with(select(.internal.apiServer.enableAdmissionPlugins != null);
.cluster.providerIntegration.controlPlane.kubeadmConfig.clusterConfiguration.apiServer.additionalAdmissionPlugins
= .internal.apiServer.enableAdmissionPlugins)' values.yaml ``` ## API server
feature gates There is no default list of feature gates in the shared cluster
chart, so if you have any values under `.internal.apiServer.featureGates` then
these must be migrated to the new location. ``` yq eval --inplace
'with(select(.internal.apiServer.featureGates != null);
.cluster.providerIntegration.controlPlane.kubeadmConfig.clusterConfiguration.apiServer.featureGates
= .internal.apiServer.featureGates)' values.yaml ``` ## Controller manager
feature gates There is no default list of feature gates in the shared cluster
chart, so if you have any values under
`.internal.controllerManager.featureGates` then these must be migrated to the
new location. ``` yq eval --inplace
'with(select(.internal.controllerManager.featureGates != null);
.cluster.providerIntegration.controlPlane.kubeadmConfig.clusterConfiguration.controllerManager.featureGates
= .internal.controllerManager.featureGates)' values.yaml ``` ### Extra
certificate SANs for Kubernetes API Any additional certificate SANs must be
added to the extraCertificateSANs list. ``` yq eval --inplace
'with(select(.internal.apiSserver.certSANs != null);
.cluster.internal.advancedConfiguration.controlPlane.apiServer.extraCertificateSANs
+= [ .internal.apiServer.certSANs[] ])' values.yaml ``` ## OIDC config
`caFile` has been renamed to `caPem`. ``` yq eval --inplace
'with(select(.global.controlPlane.oidc.caFile != null);
.global.controlPlane.oidc.caPem = .global.controlPlane.oidc.caFile)'
values.yaml ``` ## SSH trusted CA keys If you are providing additional trusted
CA keys for SSH authentication (other than the default Giant Swarm key) then
these need to migrated to the new location. ``` yq eval --inplace
'with(select(.global.connectivity.shell.sshTrustedUserCAKeys != null);
.cluster.providerIntegration.connectivity.sshSsoPublicKey =
.global.connectivity.shell.sshTrustedUserCAKeys)' values.yaml ``` ## NTP
servers If provided, NTP server addresses need to be migrated to the new
location. ``` yq eval --inplace 'with(select(.global.connectivity.ntp.servers
!= null); .cluster.providerIntegration.components.systemd.timesyncd.ntp =
.global.connectivity.ntp.servers)' values.yaml ``` ## Upstream proxy settings
Upstream proxy configuration is no longer read from the
`.global.connectivity.proxy.secretName` value so this must be removed (see the
    **Cleanup** section below). ## Additional notes * `.global.connectivity.shell`
is no longer used; this is deleted. * `.global.connectivity.ntp` is no longer
used; this is deleted. * `.global.controlPlane.certSANs` is no longer used;
this is deleted. * `.global.controlPlane.image` is no longer used; this is
deleted. * `.global.controlPlane.resourceRatio` is no longer used; this is
deleted. * `.internal.sandboxContainerImage` is no longer used; this is
deleted. ## Cleanup Final tidyup to remove deprecated values: ``` yq eval
--inplace 'del(.global.controlPlane.catalog) |
del(.global.controlPlane.diskSizeGB) |
del(.global.controlPlane.placementPolicy) |
del(.global.controlPlane.sizingPolicy) |
del(.global.controlPlane.storageProfile) | del(.global.controlPlane.template)
| del(.global.controlPlane.certSANs) | del(.internal.apiServer) |
del(.internal.controllerManager) | del(.global.controlPlane.oidc.caFile) |
del(.global.connectivity.ntp) | del(.global.connectivity.shell) |
del(.global.connectivity.proxy.secretName) |
del(.internal.sandboxContainerImage) | del(.global.controlPlane.image) |
del(.global.controlPlane.resourceRatio)' values.yaml ``` > [!NOTE] > End of
upgrade guide. \---
      * Use `giantswarm/cluster` chart to render `KubeadmControlPlane` resource.
      * Fix disk size calculation for worker nodes. 


- [cluster-vsphere](https://github.com/giantswarm/cluster-vsphere) 
  - [0.65.0](https://github.com/giantswarm/cluster-
vsphere/compare/v0.64.0...v0.65.0) 
### :warning: **Breaking change** :warning:
      * Support for Release CR's.
Migration steps * In ConfigMap `-userconfig` set `.Values.global.release` to
the release version, e.g. `27.0.0`. * In App `` set the `version` to an empty
string.
      * Update `kube-vip` static pod to v0.8.3.
      * Allow `.Values.global.managementCluster` in values schema.
- [dns-operator-route53](https://github.com/giantswarm/dns-operator-route53) 
  - [0.10.0](https://github.com/giantswarm/dns-operator-
route53/compare/v0.9.2...v0.10.0) 
      * Add optional `--role-arn` flag to specify the role ARN to assume when interacting with Route53.
- [teleport-operator](https://github.com/giantswarm/teleport-operator) 
  - [0.12.0](https://github.com/giantswarm/teleport-
operator/compare/v0.11.2...v0.12.0) 
      * Changed the logic of setting roles by parsing `"%s-teleport-kube-agent-user-values"` configmaps to check if apps are enabled.
      * Deprecated `MC-Namespace` and `tokenRoles`
  - [0.11.2](https://github.com/giantswarm/teleport-
operator/compare/v0.11.1...v0.11.2) 
      * Implemented `MC-Namespace` flag to avoid enabling roles except `kube` to workload clusters
      * Increased `grpc buffer` size 


  - [0.11.1](https://github.com/giantswarm/teleport-
operator/compare/v0.11.0...v0.11.1) 
      * Set only `kube` by default to aviod issues when no apps are set. 


  - [0.11.0](https://github.com/giantswarm/teleport-
operator/compare/v0.10.0...v0.11.0) 
      * Implemented option to generate combined tokens with multiple roles
      * Change ownership to Team Shield
      * Disable logger development mode to avoid panicking
      * Chart to use `.Release.Namespace` namespace 



## Docs

<!-- FER is filling this one -->

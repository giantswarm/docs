
---
date: 2024-10-24T14:00:00
title: Highlights for the week ending 2024-10-24
changes_categories:
  - Highlights
owner:
  - https://github.com/orgs/giantswarm/teams/sig-product
---

## General

<!-- This where BREAKING CHANGES ARE HIGHLIGHTED -->

## Apps

- [prometheus-meta-operator](https://github.com/giantswarm/prometheus-meta-operator) 
  - [4.80.0](https://github.com/giantswarm/prometheus-meta-
operator/compare/v4.79.0...v4.80.0) 
      * Add `customer` label to OpsGenie alerts.
- [oauth2-proxy-app](https://github.com/giantswarm/oauth2-proxy-app) 
  - [3.0.1](https://github.com/giantswarm/oauth2-proxy-
app/compare/v3.0.0...v3.0.1) 
      * Remove cert-manager ingress annotations as it is blocking ingress validation.
- [prometheus-rules](https://github.com/giantswarm/prometheus-rules) 
  - [4.20.0](https://github.com/giantswarm/prometheus-
rules/compare/v4.19.0...v4.20.0) 
      * Added InhibitionClusterWithoutWorkerNodes for CAPA
      * Modify `KyvernoWebhookHasNoAvailableReplicas` to check specifically for Kyverno resource webhook.
      * Inhibit prometheas-agent alerts when a cluster has no worker nodes (AWS vintage only for now)
- [app-admission-controller](https://github.com/giantswarm/app-admission-controller) 
  - [0.26.2](https://github.com/giantswarm/app-admission-
controller/compare/v0.26.1...v0.26.2) 
      * Extend the `/healthz` endpoint to check for a valid certificate and let Kubernetes liveness probes handle restarts in case of an error.
- [app-operator](https://github.com/giantswarm/app-operator) 
  - [6.11.2](https://github.com/giantswarm/app-operator/compare/v6.11.1...v6.11.2)
- [cluster-cloud-director](https://github.com/giantswarm/cluster-cloud-director) 
  - [0.62.0](https://github.com/giantswarm/cluster-cloud-
director/compare/v0.61.2...v0.62.0) 
> [!WARNING] This release adds all default apps to cluster-cloud-director, so
> the default-apps-cloud-director App is not used anymore. These changes in
> cluster-cloud-director are breaking and the cluster upgrade requires manual
> steps where the default-apps-cloud-director App is removed before upgrading
> cluster-cloud-director. See details below.
      * Render capi-node-labeler App CR from cluster chart.
      * Render cert-exporter App CR from cluster chart and add cloud-director-specific cert-exporter config.
      * Render cert-manager App CR from cluster chart and add cloud-director-specific cert-manager config.
      * Render chart-operator-extensions App CR from cluster chart.
      * Render cilium HelmRelease CR from cluster chart and add cloud-director-specific cilium config.
      * Render cilium-servicemonitors App CR from cluster chart.
      * Render coredns HelmRelease CR from cluster chart.
      * Render etc-kubernetes-resources-count-exporter App CR from cluster chart.
      * Render k8s-dns-node-cache App CR from cluster chart.
      * Render metrics-server App CR from cluster chart.
      * Render net-exporter App CR from cluster chart.
      * Render network-policies HelmRelease CR from cluster chart and add cloud-director-specific network-policies config.
      * Render node-exporter App CR from cluster chart and add cloud-director-specific node-exporter config.
      * Render observability-bundle App CR from cluster chart.
      * Render observability-policies App CR from cluster chart.
      * Render security-bundle App CR from cluster chart.
      * Render teleport-kube-agent App CR from cluster chart.
      * Render vertical-pod-autoscaler App CR from cluster chart.
      * Render vertical-pod-autoscaler-crd HelmRelease CR from cluster chart.
      * Render HelmRepository CRs from cluster chart.
      * Remove cilium HelmRelease.
      * Remove coredns HelmRelease.
      * Remove network-policies HelmRelease.
      * Remove HelmRepository CRs.
### ⚠️ Workload cluster upgrade with manual steps
The steps to upgrade a workload cluster with the unified cluster-cloud-
director and default-apps-cloud-director are the following: \- Upgrade
default-apps-cloud-director App to the v0.11.0 release. \- Update default-
apps-cloud-director Helm value
`.Values.deleteOptions.moveAppsHelmOwnershipToClusterCloudDirector` to `true`.
\- All App CRs, except observability-bundle and security-bundle, will get
`app-operator.giantswarm.io/paused: true` annotation, so wait few minutes for
Helm post-upgrade hook to apply the change to all required App CRs. \- Check
all App CRs deployed by default-apps-cloud-director to see if they reference
any `extraConfigs`; if so then these must be added to the `cluster-cloud-
director` values for use when the cluster is upgraded to `v0.62.0` (see
below). For more information on how to do this, see the [giantswarm/cluster
chart
readme](https://github.com/giantswarm/cluster/tree/main/helm/cluster#apps). \-
Delete default-apps-cloud-director App CR. \- ⚠️ In case you are removing the
default-apps-cloud-director App CR from your gitops repo which is using Flux,
and depending on how Flux is configured, the default-apps-cloud-director App
CR may or may not get deleted from the management cluster. In case Flux does
not delete the default-apps-cloud-director App CR from the management cluster,
make sure to delete it manually. \- App CRs (on the MC) for all default Apps
will be deleted. Wait a few minutes for this to happen. \- Chart CRs on the
workload cluster will remain untouched, so all apps will continue running. \-
Upgrade the cluster-cloud-director App CR to the v0.62.0 release. \- cluster-
cloud-director will deploy all default Apps, so wait a few minutes for all
Apps to be successfully deployed. \- Chart resources on the workload cluster
will get updated, as newly deployed App resources will take over the
reconciliation of the existing Chart resources.
### Manual fixes
We're almost there, with just a couple more issues to fix manually.
#### Vertical Pod Autoscaler
The VPA CRD used to be installed as an App resource from default-apps-cloud-
director, but now it's being installed as a HelmRelease from cluster-cloud-
director. Now, as a consequence of the above upgrade, we have the following
situation: \- the default-apps-cloud-director App has been deleted, but the
vertical-pod-autoscaler-crd Chart CRs remains in the workload cluster. \-
cluster-cloud-director has been upgraded, so now it also installs the
vertical-pod-autoscaler-crd HelmRelease. \- outcome: we now have a vertical-
pod-autoscaler-crd HelmRelease in the MC and a vertical-pod-autoscaler-crd
Chart CR in the WC.
Now we will remove the leftover vertical-pod-autoscaler-crd Chart CR in a safe
way:
  1. Pause the vertical-pod-autoscaler-crd Chart CR.
Add annotation `chart-operator.giantswarm.io/paused: "true"` to the vertical-
pod-autoscaler-crd Chart CR in the workload cluster:
`sh kubectl annotate -n giantswarm chart vertical-pod-autoscaler-crd chart-
operator.giantswarm.io/paused="true" --overwrite`
  1. Delete the vertical-pod-autoscaler-crd Chart CR in the workload cluster.
`shell kubectl delete -n giantswarm chart vertical-pod-autoscaler-crd`
Kubectl will probably hang, as the chart-operator finalizer is not removed
(vertical-pod-autoscaler-crd Chart CR has been paused). Proceed to the next
step to remove the finalizer and unblock the deletion.
  1. Remove finalizers from the vertical-pod-autoscaler-crd Chart CR
Open another terminal window and run the following command to remove the
vertical-pod-autoscaler-crd Chart CR finalizers:
`shell kubectl patch chart vertical-pod-autoscaler-crd -n giantswarm
--type=json -p='[{"op": "remove", "path": "/metadata/finalizers"}]'`
This will unblock the deletion and vertical-pod-autoscaler-crd will get
removed, **without actually deleting the VPA CustomResourceDefinition**.
From now on, the VPA CustomResourceDefinition will be maintained by the
vertical-pod-autoscaler HelmRelease on the management cluster.
#### Observability Platform Configuration
The observability operator is responsible for creating the `<cluster-
name>-observability-platform-configuration` configmap and patching the
`<cluster-name>-observability-bundle` app to reference it. This configuration
is lost after upgrading the cluster app. As a result, the observability
operator has to be restarted.
`shell kubectl delete pod -n monitoring -l
app.kubernetes.io/instance=observability-operator`
- [cluster-vsphere](https://github.com/giantswarm/cluster-vsphere) 
  - [0.65.1](https://github.com/giantswarm/cluster-
vsphere/compare/v0.65.0...v0.65.1) 
      * Render Flatcar and Kubernetes version from cluster chart.
- [default-apps-cloud-director](https://github.com/giantswarm/default-apps-cloud-director) 
  - [0.11.0](https://github.com/giantswarm/default-apps-cloud-
director/compare/v0.10.0...v0.11.0) 
> [!WARNING] This release includes changes that enable the unification of
> cluster-cloud-director and default-apps-cloud-director. The unification of
> cluster-cloud-director and default-apps-cloud-director does not happen
> automatically, it must be enabled explicitly and even then it requires
> manual steps.
    **See`cluster-cloud-director`
[changelog](https://github.com/giantswarm/cluster-cloud-
director/blob/main/CHANGELOG.md#0620---2024-10-21) for the upgrade
walkthrough.**
      * New Helm value `.Values.deleteOptions.moveAppsHelmOwnershipToClusterCloudDirector`, which, when enabled, will pause all apps in the default-apps-cloud-director, and it will enable the below hooks. The apps are paused in order to prevent the deletion of Chart resources in the WC.
      * Helm hook to remove app-operator finalizer from App CRs, so that App CRs are deleted from the MC, while Chart CRs stay on the WC.
      * Helm hook to propagate pause annotation to all bundled apps.
- [falco-app](https://github.com/giantswarm/falco-app) 
  - [0.9.1](https://github.com/giantswarm/falco-app/compare/v0.9.0...v0.9.1) 
      * Add feature gates for enabling/disabling individual Falco components.
- [starboard-exporter](https://github.com/giantswarm/starboard-exporter) 
  - [0.8.0](https://github.com/giantswarm/starboard-
exporter/compare/v0.7.11...v0.8.0) 
      * Add Vertical Pod Autoscaler (VPA) configuration, enabled by default.
      * Disable logger development mode to avoid panicking.
      * Disable PodSecurityPolicy by default.
      * Expose port 8081 for health/liveness probes.
- [teleport-operator](https://github.com/giantswarm/teleport-operator) 
  - [0.12.1](https://github.com/giantswarm/teleport-
operator/compare/v0.12.0...v0.12.1) 
      * Added enable/disable switch on `tbot` components
- [trivy-app](https://github.com/giantswarm/trivy-app) 
  - [0.13.0](https://github.com/giantswarm/trivy-app/compare/v0.12.0...v0.13.0) 
      * Update `Trivy` to upstream version v0.56.1.
      * Disable PSPs.
- [trivy-operator-app](https://github.com/giantswarm/trivy-operator-app) 
  - [0.10.2](https://github.com/giantswarm/trivy-operator-
app/compare/v0.10.1...v0.10.2) 
      * Align Trivy versions between Trivy Operator and Trivy to v0.56.1.

## Docs

<!-- FER is filling this one -->

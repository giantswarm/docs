# This workflow, when done, is supposed to update automatically
# generated content in these sections:
# - Changes and releases
# - CRDs (Management API)
# - Cluster Apps
# - CLI versions
# - Website header and footer
name: Update generated content

# Trigger by cronjob
on:
  schedule:
    # It runs at 7:00 every weekday
    - cron: "0 7 * * MON-FRI"
  workflow_dispatch: {} # Allow manual triggering

jobs:
  update-generated-content:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          persist-credentials: false

      - name: Aggregate releases
        env:
          GITHUB_TOKEN: ${{ secrets.TOKEN }}
        run: make changes

      - name: Update Cluster Apps pages
        run: make update-cluster-app-reference

      - name: Update CRD pages
        run: make update-crd-reference

      - name: Update website header and footer
        run: make update-website-content

      - name: Create or update pull request
        uses: gr2m/create-or-update-pull-request-action@v1.9.4
        env:
          GITHUB_TOKEN: ${{ secrets.TOKEN }}
        with:
          title: "Semi-automatic update of generated content"
          branch: "automatic-update-of-generated-content"
          commit-message: "Update self-generated content"
          assignees: taylorbot
          reviewers: pipo02mix
          body: |
            This PR has been created automatically by the 'Update generated content' Github workflow
            to keep

            - Changes and releases
            - CLI versions
            - Cluster Apps
            - CRD pages
            - Website header and footer

            up-to-date.

            This PR is opened or updated every weekday morning. On Fridays, it is merged by 'merge-autogenerated-content' workflow. In case of being triggered manually you need to merge it manually too in order to have the content published.

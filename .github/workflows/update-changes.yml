# This workflow, when done, is supposed to update automatically
# generated content in these sections:
# - Changes and releases
# - CRDs (Management API)
# - CLI versions
# - Website header and footer
name: Update generated content

# Trigger by cronjob
on:
  schedule:
    # It runs at 7:00 every weekday
    - cron: "0 7 * * MON-FRI"
  workflow_dispatch: {} # Allow manual triggering

jobs:
  update-generated-content:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Aggregate releases
        env:
          GITHUB_TOKEN: ${{ secrets.TOKEN }}
        run: make changes

      - name: Update Cluster Apps pages
        run: make update-cluster-app-reference

      - name: Update CRD pages
        run: make update-crd-reference

      - name: Update website header and footer
        run: make update-website-content

      - name: Create or update pull request
        uses: gr2m/create-or-update-pull-request-action@v1.3.1
        env:
          GITHUB_TOKEN: ${{ secrets.TOKEN }}
        with:
          title: Semi-automatic update of generated content
          branch: "automatic-update-of-generated-content"
          assignees: taylorbot
          reviewers: pipo02mix
          body: |
            This PR has been created automatically by the 'Update generated content' Github workflow
            to keep

            - Changes and releases
            - CLI versions
            - CRD pages
            - Website header and footer

            up-to-date.

            This PR is opened every Monday morning and merged on Friday automatically 
            if it has not been manually merged.

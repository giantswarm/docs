name: Merge generated content updates

# Trigger by cronjob
on:
  schedule:
    # Merge the PR every Friday at 10:00 UTC
    - cron: "0 10 * * FRI"
  workflow_dispatch: {} # Allow manual triggering

jobs:
  merge-autogenerated-content:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: "automatic-update-of-generated-content"
          fetch-depth: 0
          persist-credentials: false

      - name: Find Pull Request
        uses: juliangruber/find-pull-request-action@v1
        id: find-pull-request
        with:
          branch: automatic-update-of-generated-content

      - name: Update self-generated content branch with main branch changes
        uses: prompt/actions-merge-branch@v2
        with:
          from: "origin/main"

      - name: Approve Pull Request
        uses: juliangruber/approve-pull-request-action@v2
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          number: ${{ steps.find-pull-request.outputs.number }}

      - name: Merge Pull Request
        uses: juliangruber/merge-pull-request-action@v1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          number: ${{ steps.find-pull-request.outputs.number }}
          method: squash

name: Merge generated content updates

# Trigger by cronjob
on:
  schedule:
    # Merge the PR every Friday at 10:00 UTC
    - cron: "0 10 * * FRI"
  workflow_dispatch: {} # Allow manual triggering

jobs:
  merge-autogenerated-content:
    runs-on: ubuntu-latest
    permissions:
      checks: read
      contents: write
      pull-requests: write
    steps:
      - name: Checkout code
        uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
        with:
          ref: "automatic-update-of-generated-content"
          fetch-depth: 0

      - name: Update self-generated content branch with main branch changes
        uses: prompt/actions-merge-branch@701d2a3e181424b84ebb58c95531d1d64fc3eccc # v2
        with:
          from: "origin/main"

      - name: Find Pull Request
        uses: juliangruber/find-pull-request-action@952b3bb1ddb2dcc0aa3479e98bb1c2d1a922f096 # v1.10.0
        id: find-pull-request
        with:
          branch: automatic-update-of-generated-content

      - name: Approve Pull Request
        uses: juliangruber/approve-pull-request-action@b71c44ff142895ba07fad34389f1938a4e8ee7b0 # v2.0.6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          number: ${{ steps.find-pull-request.outputs.number }}

      - name: GitHub Checks
        uses: poseidon/wait-for-status-checks@899c768d191b56eef585c18f8558da19e1f3e707 # v0.6.0
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Merge Pull Request
        uses: juliangruber/merge-pull-request-action@9234b8714dda9a08f3d1df5b2a6a3abd7b695353 # v1.3.1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          number: ${{ steps.find-pull-request.outputs.number }}
          method: squash
